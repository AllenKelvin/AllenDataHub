
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

Connected to MongoDB
Current Order indexes: {
  _id_: [ [ '_id', 1 ] ],
  userId_1: [ [ 'userId', 1 ] ],
  productId_1: [ [ 'productId', 1 ] ],
  status_1: [ [ 'status', 1 ] ],
  id_1: [ [ 'id', 1 ] ]
}
Enforced password for @Admin001
Enforced password for @Admin002
Scheduled daily reset in 75055283ms (next GMT midnight)
3:09:05 AM [express] serving on port 5000 (127.0.0.1)
3:09:23 AM [express] GET /api/user 200 in 478ms :: [{"_id":"697cc1da20dcfd084b4ddb8e","username":"@Admin001","password":"0c096aa93c3ebf9e0dcb1ecb0921693e64d3f4c17fdf614ff76471203ed2a8edcd94f20676442ffd727a9215824057ba8c8bdf45fbeced06bf8a578af7267ad1.45a747b7bc78d90add5aade06dfd438b","role":"admin","isVerified":true,"balance":0,"totalOrdersToday":0,"totalGBSentToday":0,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T14:36:10.109Z","updatedAt":"2026-02-03T03:09:04.005Z","__v":0,"id":"697cc1da20dcfd084b4ddb8e","totalGBPurchased":0}]
3:09:24 AM [express] GET /api/user 304 in 499ms :: [{"_id":"697cc1da20dcfd084b4ddb8e","username":"@Admin001","password":"0c096aa93c3ebf9e0dcb1ecb0921693e64d3f4c17fdf614ff76471203ed2a8edcd94f20676442ffd727a9215824057ba8c8bdf45fbeced06bf8a578af7267ad1.45a747b7bc78d90add5aade06dfd438b","role":"admin","isVerified":true,"balance":0,"totalOrdersToday":0,"totalGBSentToday":0,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T14:36:10.109Z","updatedAt":"2026-02-03T03:09:04.005Z","__v":0,"id":"697cc1da20dcfd084b4ddb8e","totalGBPurchased":0}]
[Cart] getCart for user 697cc1da20dcfd084b4ddb8e: []
3:09:24 AM [express] GET /api/users/agents/unverified 304 in 634ms :: [{"_id":"697f8ae6581520cdf7b6f4d8","username":"agent2","email":"allen@gmail.com","phoneNumber":null,"password":"0bab255a9fbab1614e531127c9476172b3681857d6dec70eb93a8da2f119d393d76b884b31e3b02b07708d8dfe5d3637f66bd6c2977186cc5508b746e770162a.ab1c64ef7b7be4976c95570133048901","role":"agent","isVerified":false,"balance":0,"totalOrdersToday":0,"totalGBSentToday":0,"totalSpentToday":0,"cart":[],"createdAt":"2026-02-01T17:18:30.368Z","updatedAt":"2026-02-02T23:59:59.721Z","__v":0,"id":"697f8ae6581520cdf7b6f4d8"}]
3:09:24 AM [express] GET /api/cart 304 in 657ms :: []
3:09:28 AM [express] POST /api/logout 200 in 829ms
3:09:38 AM [express] POST /api/login 200 in 900ms :: {"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":240.10000000000014,"totalOrdersToday":3,"totalGBSentToday":3,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:04:51.667Z","__v":0,"totalGBPurchased":4,"id":"697d041ee5233d43be3cb510"}
[Cart] getCart for user 697d041ee5233d43be3cb510: []
3:09:39 AM [express] GET /api/user 200 in 488ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":240.10000000000014,"totalOrdersToday":3,"totalGBSentToday":3,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:04:51.667Z","__v":0,"totalGBPurchased":4,"id":"697d041ee5233d43be3cb510"}]
3:09:39 AM [express] GET /api/cart 304 in 647ms :: []
3:09:39 AM [express] GET /api/orders/mine 304 in 647ms :: {"orders":[],"pagination":{"total":0,"page":1,"limit":10,"pages":0},"completedCount":0}
3:09:42 AM [express] GET /api/user 304 in 479ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":240.10000000000014,"totalOrdersToday":3,"totalGBSentToday":3,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:04:51.667Z","__v":0,"totalGBPurchased":4,"id":"697d041ee5233d43be3cb510"}]
3:09:43 AM [express] GET /api/products 304 in 639ms :: [{"_id":"69815ba90771ff415dd64020","name":"MTN 1 GB","network":"MTN","dataAmount":"1 GB","price":0,"userPrice":4.5,"agentPrice":4.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:21:29.940Z","updatedAt":"2026-02-03T02:21:29.940Z","__v":0,"id":"69815ba90771ff415dd64020"},{"_id":"69815d9f0771ff415dd6409b","name":"MTN 2 GB","network":"MTN","dataAmount":"2 GB","price":0,"userPrice":8.5,"agentPrice":8.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:29:51.122Z","updatedAt":"2026-02-03T02:29:51.122Z","__v":0,"id":"69815d9f0771ff415dd6409b"},{"_id":"698165a7b445fed77f2fae35","name":"5 GB","network":"Telecel","dataAmount":"5 GB","price":0,"userPrice":20.1,"agentPrice":19.7,"description":"Non-Expiry","createdAt":"2026-02-03T03:04:07.513Z","updatedAt":"2026-02-03T03:04:07.513Z","__v":0,"id":"698165a7b445fed77f2fae35"}]
[Cart] Current cart for user 697d041ee5233d43be3cb510: []
[Cart] Looking for match: productId=69815ba90771ff415dd64020, phoneNumber=0245893903
[Cart] existingIndex=-1
[Cart] Adding new item 69815ba90771ff415dd64020 with phone 0245893903 to cart for user 697d041ee5233d43be3cb510
[Cart] Cart item to push: {"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"}
[Cart] Successfully added, cart now: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903","_id":"698167044a25d19a1d887042"}]
[Cart] getCart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"}]
3:09:57 AM [express] POST /api/cart/add 200 in 1196ms :: [{"product":{"_id":"69815ba90771ff415dd64020","name":"MTN 1 GB","network":"MTN","dataAmount":"1 GB","price":0,"userPrice":4.5,"agentPrice":4.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:21:29.940Z","updatedAt":"2026-02-03T02:21:29.940Z","__v":0,"id":"69815ba90771ff415dd64020"},"quantity":1,"phoneNumber":"0245893903"}]
[Cart] getCart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"}]
3:09:58 AM [express] GET /api/cart 200 in 803ms :: [{"product":{"_id":"69815ba90771ff415dd64020","name":"MTN 1 GB","network":"MTN","dataAmount":"1 GB","price":0,"userPrice":4.5,"agentPrice":4.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:21:29.940Z","updatedAt":"2026-02-03T02:21:29.940Z","__v":0,"id":"69815ba90771ff415dd64020"},"quantity":1,"phoneNumber":"0245893903"}]
[Cart] Current cart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903","_id":"698167044a25d19a1d887042"}]
[Cart] Looking for match: productId=69815d9f0771ff415dd6409b, phoneNumber=0503983929
[Cart] Checking item: prodId=69815ba90771ff415dd64020, phone=0245893903, matches=false
[Cart] existingIndex=-1
[Cart] Adding new item 69815d9f0771ff415dd6409b with phone 0503983929 to cart for user 697d041ee5233d43be3cb510
[Cart] Cart item to push: {"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929"}
[Cart] Successfully added, cart now: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903","_id":"698167044a25d19a1d887042"},{"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929","_id":"698167124a25d19a1d88704b"}]
[Cart] getCart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"},{"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929"}]
3:10:10 AM [express] POST /api/cart/add 200 in 1419ms :: [{"product":{"_id":"69815ba90771ff415dd64020","name":"MTN 1 GB","network":"MTN","dataAmount":"1 GB","price":0,"userPrice":4.5,"agentPrice":4.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:21:29.940Z","updatedAt":"2026-02-03T02:21:29.940Z","__v":0,"id":"69815ba90771ff415dd64020"},"quantity":1,"phoneNumber":"0245893903"},{"product":{"_id":"69815d9f0771ff415dd6409b","name":"MTN 2 GB","network":"MTN","dataAmount":"2 GB","price":0,"userPrice":8.5,"agentPrice":8.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:29:51.122Z","updatedAt":"2026-02-03T02:29:51.122Z","__v":0,"id":"69815d9f0771ff415dd6409b"},"quantity":1,"phoneNumber":"0503983929"}]
[Cart] getCart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"},{"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929"}]
3:10:11 AM [express] GET /api/cart 200 in 808ms :: [{"product":{"_id":"69815ba90771ff415dd64020","name":"MTN 1 GB","network":"MTN","dataAmount":"1 GB","price":0,"userPrice":4.5,"agentPrice":4.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:21:29.940Z","updatedAt":"2026-02-03T02:21:29.940Z","__v":0,"id":"69815ba90771ff415dd64020"},"quantity":1,"phoneNumber":"0245893903"},{"product":{"_id":"69815d9f0771ff415dd6409b","name":"MTN 2 GB","network":"MTN","dataAmount":"2 GB","price":0,"userPrice":8.5,"agentPrice":8.2,"description":"Non-Expiry","createdAt":"2026-02-03T02:29:51.122Z","updatedAt":"2026-02-03T02:29:51.122Z","__v":0,"id":"69815d9f0771ff415dd6409b"},"quantity":1,"phoneNumber":"0503983929"}]
3:10:12 AM [express] GET /api/user 200 in 608ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":240.10000000000014,"totalOrdersToday":3,"totalGBSentToday":3,"totalSpentToday":0,"cart":[{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903","_id":"698167044a25d19a1d887042"},{"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929","_id":"698167124a25d19a1d88704b"}],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:10:10.155Z","__v":0,"totalGBPurchased":4,"id":"697d041ee5233d43be3cb510"}]
[Cart] getCart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"},{"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929"}]
[Checkout] Cart for user 697d041ee5233d43be3cb510: [{"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"},{"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929"}]
[Checkout] Total price calculated: 12.399999999999999, Payment method: wallet
[Checkout] Agent 697d041ee5233d43be3cb510 attempting wallet payment. Balance: 240.10000000000014, Total: 12.399999999999999
[Checkout] Deducting GHS 12.399999999999999 from agent wallet
[Portal02] Initialized. Base: https://www.portal-02.com/api/v1, Webhook: http://localhost:5000/api/webhooks/portal02
[Checkout] Processing 2 cart items for wallet payment
[Checkout] Processing cart item: {"productId":"69815ba90771ff415dd64020","quantity":1,"phoneNumber":"0245893903"}
[Checkout] Item has quantity: 1, will create 1 orders
[Checkout] Creating order 1/1 for product 69815ba90771ff415dd64020, phone: 0245893903
[Order] Created order 698167194a25d19a1d88705c for user 697d041ee5233d43be3cb510, product 69815ba90771ff415dd64020
[Checkout] Created order: {"userId":"697d041ee5233d43be3cb510","productId":"69815ba90771ff415dd64020","status":"processing","paymentStatus":"success","price":4.2,"dataAmount":"1 GB","phoneNumber":"0245893903","productName":"MTN 1 GB","_id":"698167194a25d19a1d88705c","processingResults":[],"webhookHistory":[],"createdAt":"2026-02-03T03:10:17.327Z","updatedAt":"2026-02-03T03:10:17.327Z","__v":0,"id":"698167194a25d19a1d88705c"}
[Checkout] Processing cart item: {"productId":"69815d9f0771ff415dd6409b","quantity":1,"phoneNumber":"0503983929"}
[Checkout] Item has quantity: 1, will create 1 orders
[Checkout] Creating order 1/1 for product 69815d9f0771ff415dd6409b, phone: 0503983929
[Order] Failed to create order: E11000 duplicate key error collection: test.orders index: id_1 dup key: { id: null }
[Checkout] Failed to create order for product 69815d9f0771ff415dd6409b: E11000 duplicate key error collection: test.orders index: id_1 dup key: { id: null }
[Checkout] Payment successful. Created 1 orders
3:10:25 AM [express] POST /api/cart/checkout 200 in 8976ms :: {"status":"ok","message":"Payment successful","orders":[{"userId":"697d041ee5233d43be3cb510","productId":"69815ba90771ff415dd64020","status":"processing","paymentStatus":"success","price":4.2,"dataAmount":"1 GB","phoneNumber":"0245893903","productName":"MTN 1 GB","_id":"698167194a25d19a1d88705c","processingResults":[],"webhookHistory":[],"createdAt":"2026-02-03T03:10:17.327Z","updatedAt":"2026-02-03T03:10:17.327Z","__v":0,"id":"698167194a25d19a1d88705c"}]}
[Cart] getCart for user 697d041ee5233d43be3cb510: []
3:10:25 AM [express] GET /api/user 200 in 455ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":227.70000000000013,"totalOrdersToday":4,"totalGBSentToday":4,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:10:24.695Z","__v":0,"totalGBPurchased":5,"id":"697d041ee5233d43be3cb510"}]
3:10:25 AM [express] GET /api/user 200 in 465ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":227.70000000000013,"totalOrdersToday":4,"totalGBSentToday":4,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:10:24.695Z","__v":0,"totalGBPurchased":5,"id":"697d041ee5233d43be3cb510"}]
3:10:25 AM [express] GET /api/cart 200 in 635ms :: []
3:10:29 AM [express] GET /api/user 304 in 493ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":227.70000000000013,"totalOrdersToday":4,"totalGBSentToday":4,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:10:24.695Z","__v":0,"totalGBPurchased":5,"id":"697d041ee5233d43be3cb510"}]
3:10:30 AM [express] GET /api/orders/mine 200 in 823ms :: {"orders":[{"_id":"698167194a25d19a1d88705c","userId":"697d041ee5233d43be3cb510","productId":"69815ba90771ff415dd64020","status":"failed","paymentStatus":"success","price":4.2,"dataAmount":"1 GB","phoneNumber":"0245893903","productName":"MTN 1 GB","processingResults":[{"itemIndex":0,"success":false,"error":"Insufficient wallet balance. Required: ₵4.00","status":"failed","_id":"698167204a25d19a1d887061"}],"webhookHistory":[],"createdAt":"2026-02-03T03:10:17.327Z","updatedAt":"2026-02-03T03:10:24.187Z","__v":0,"id":"698167194a25d19a1d88705c","productNetwork":"MTN"}],"pagination":{"total":1,"page":1,"limit":10,"pages":1},"completedCount":0}
3:10:43 AM [express] GET /api/user 304 in 483ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":227.70000000000013,"totalOrdersToday":4,"totalGBSentToday":4,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:10:24.695Z","__v":0,"totalGBPurchased":5,"id":"697d041ee5233d43be3cb510"}]
3:10:43 AM [express] GET /api/user 304 in 472ms :: [{"_id":"697d041ee5233d43be3cb510","username":"agent1","email":"allenkelvin175@gmail.com","password":"c1cd7558200e791555f8082dacc9aa49c4082cdf6312589767be6906a24bbfbeb58568bbdc544aa1ef8615fbb07f3fd3757f446dc854190f364b310363f885c2.9f7e5c95a30843371b7c41b0150a424c","role":"agent","isVerified":true,"balance":227.70000000000013,"totalOrdersToday":4,"totalGBSentToday":4,"totalSpentToday":0,"cart":[],"createdAt":"2026-01-30T19:18:54.653Z","updatedAt":"2026-02-03T03:10:24.695Z","__v":0,"totalGBPurchased":5,"id":"697d041ee5233d43be3cb510"}]
[Cart] getCart for user 697d041ee5233d43be3cb510: []
3:10:44 AM [express] GET /api/cart 304 in 655ms :: []
3:10:44 AM [express] GET /api/orders/mine 304 in 788ms :: {"orders":[{"_id":"698167194a25d19a1d88705c","userId":"697d041ee5233d43be3cb510","productId":"69815ba90771ff415dd64020","status":"failed","paymentStatus":"success","price":4.2,"dataAmount":"1 GB","phoneNumber":"0245893903","productName":"MTN 1 GB","processingResults":[{"itemIndex":0,"success":false,"error":"Insufficient wallet balance. Required: ₵4.00","status":"failed","_id":"698167204a25d19a1d887061"}],"webhookHistory":[],"createdAt":"2026-02-03T03:10:17.327Z","updatedAt":"2026-02-03T03:10:24.187Z","__v":0,"id":"698167194a25d19a1d88705c","productNetwork":"MTN"}],"pagination":{"total":1,"page":1,"limit":10,"pages":1},"completedCount":0}
